<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Dropshipping Command Center</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
<style>
  *{box-sizing:border-box;margin:0;padding:0}
  body{background:#111827;color:#fff;font-family:system-ui,sans-serif;min-height:100vh}
  input,select,textarea{background:#1f2937;color:#fff;border:1px solid #374151;border-radius:6px;padding:6px 10px;font-size:13px;width:100%;outline:none}
  input:focus,select:focus,textarea:focus{border-color:#3b82f6}
  button{cursor:pointer;border:none;font-family:inherit}
  ::-webkit-scrollbar{width:6px;height:6px}
  ::-webkit-scrollbar-track{background:#1f2937}
  ::-webkit-scrollbar-thumb{background:#374151;border-radius:3px}
  pre{font-family:inherit}
  .drop-zone{border:2px dashed #374151;border-radius:8px;padding:20px;text-align:center;cursor:pointer;transition:border-color 0.2s}
  .drop-zone:hover,.drop-zone.drag-over{border-color:#3b82f6;background:#1e3a5f22}
  .img-thumb{position:relative;display:inline-block;margin:4px}
  .img-thumb img{max-width:120px;max-height:120px;border-radius:6px;border:1px solid #374151;object-fit:cover}
  .img-thumb .del{position:absolute;top:-6px;right:-6px;background:#ef4444;color:#fff;border-radius:50%;width:18px;height:18px;font-size:11px;display:flex;align-items:center;justify-content:center;cursor:pointer}
  .lightbox{position:fixed;top:0;left:0;width:100%;height:100%;background:#000000cc;display:flex;align-items:center;justify-content:center;z-index:9999;cursor:pointer}
  .lightbox img{max-width:90vw;max-height:90vh;border-radius:8px;object-fit:contain}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const {useState,useEffect,useRef}=React;

const T={
  en:{
    title:"üöÄ Dropshipping Command Center",subtitle:"Starting Budget: $1,000 ‚Äî Data saves automatically",
    tabs:{dashboard:"üìä Dashboard",campaigns:"üìà Campaigns",products:"üì¶ Products",expenses:"üí∏ Expenses",folder:"üìÅ Folder",snapshots:"üì∑ Snapshots"},
    dashboard:{budgetLeft:"Budget Left",totalSpend:"Total Spend",totalRevenue:"Total Revenue",netProfit:"Net Profit",avgCPA:"Avg CPA",roas:"ROAS",purchases:"Purchases",avgCTR:"Avg CTR",budgetAlloc:"Budget Allocation",adSpendRes:"Ad Spend Reserve",toolsSetup:"Tools & Setup",scaleRes:"Scale Reserve",topCampaigns:"Top Campaigns by ROAS",noCampaigns:"No campaigns logged yet.",quickSnap:"üì∑ Quick Snapshot",snapDesc:"Freeze your numbers to compare progress over time",snapPh:'Label e.g. "End of Week 1"',save:"Save"},
    campaigns:{logTitle:"Log FB Campaign Entry",importBtn:"üì• Import FB CSV",importDesc:"Export from FB Ads Manager and upload ‚Äî we auto-populate your entries",importNote:"After import assign Product manually per row",date:"Date",campaign:"Campaign Name",adset:"Ad Set Name",creative:"Creative / Hook",product:"Product",budget:"Daily Budget ($)",spend:"Spend ($)",ctr:"CTR (%)",cpc:"CPC ($)",atc:"Add to Carts",purchases:"Purchases",revenue:"Revenue ($)",status:"Status",cpaAuto:"CPA (auto)",roasAuto:"ROAS (auto)",signal:"Signal",logBtn:"+ Log Entry",logTitle2:"Campaign Log",noEntries:"No entries yet.",enterData:"‚ö™ Enter data",scale:"üü¢ Scale",watch:"üü° Watch",kill:"üî¥ Kill",statuses:["testing","winner","scaling","killed"],importSuccess:"imported from FB CSV. Assign products manually.",importFail:"Could not read CSV. Make sure it is exported from FB Ads Manager."},
    products:{edit:"Edit",save:"Save",sell:"Sell",cost:"Cost",ship:"Ship",fees:"Fees",margin:"Margin",beCPA:"BE CPA",targetCPA:"Target CPA"},
    expenses:{addTitle:"Add Expense",label:"Label",amount:"Amount ($)",category:"Category",addBtn:"+ Add",logTitle:"Expense Log",total:"Total",cats:["tools","ads","product","creative","other"]},
    folder:{addTitle:"Add Note / Reference",titlePh:"Title e.g. Blue Zones Hook Variations",contentPh:"Notes, copy, hooks, angles...",images:"Images",cat:"Category",prod:"Product",saveBtn:"+ Save",noNotes:"No notes yet.",addMore:"Add more images"},
    snapshots:{title:"üì∑ Save Snapshot",desc:"Freeze your numbers week over week",ph:'e.g. "End of Week 1"',save:"Save",none:"No snapshots yet.",breakdown:"Product Breakdown"},
    signals:{noData:"‚ö™ No data",scale:"üü¢ Scale",watch:"üü° Watch",kill:"üî¥ Kill"},
  },
  es:{
    title:"üöÄ Centro de Comando Dropshipping",subtitle:"Presupuesto Inicial: $1,000 ‚Äî Datos guardados autom√°ticamente",
    tabs:{dashboard:"üìä Panel",campaigns:"üìà Campa√±as",products:"üì¶ Productos",expenses:"üí∏ Gastos",folder:"üìÅ Carpeta",snapshots:"üì∑ Capturas"},
    dashboard:{budgetLeft:"Presupuesto Restante",totalSpend:"Gasto Total",totalRevenue:"Ingresos Totales",netProfit:"Ganancia Neta",avgCPA:"CPA Promedio",roas:"ROAS",purchases:"Compras",avgCTR:"CTR Promedio",budgetAlloc:"Distribuci√≥n de Presupuesto",adSpendRes:"Reserva de Anuncios",toolsSetup:"Herramientas y Config",scaleRes:"Reserva para Escalar",topCampaigns:"Mejores Campa√±as por ROAS",noCampaigns:"A√∫n no hay campa√±as.",quickSnap:"üì∑ Captura R√°pida",snapDesc:"Congela tus n√∫meros para comparar progreso",snapPh:'Ej. "Fin de Semana 1"',save:"Guardar"},
    campaigns:{logTitle:"Registrar Campa√±a FB",importBtn:"üì• Importar CSV de FB",importDesc:"Exporta desde FB Ads Manager y sube aqu√≠ ‚Äî poblamos tus entradas autom√°ticamente",importNote:"Tras importar asigna Producto manualmente",date:"Fecha",campaign:"Nombre de Campa√±a",adset:"Conjunto de Anuncios",creative:"Creativo / Hook",product:"Producto",budget:"Presupuesto Diario ($)",spend:"Gasto ($)",ctr:"CTR (%)",cpc:"CPC ($)",atc:"A√±adir al Carrito",purchases:"Compras",revenue:"Ingresos ($)",status:"Estado",cpaAuto:"CPA (auto)",roasAuto:"ROAS (auto)",signal:"Se√±al",logBtn:"+ Registrar",logTitle2:"Registro de Campa√±as",noEntries:"Sin entradas a√∫n.",enterData:"‚ö™ Ingresa datos",scale:"üü¢ Escalar",watch:"üü° Observar",kill:"üî¥ Eliminar",statuses:["probando","ganador","escalando","eliminado"],importSuccess:"entradas importadas. Asigna productos manualmente.",importFail:"No se pudo leer el CSV. Aseg√∫rate de exportarlo desde FB Ads Manager."},
    products:{edit:"Editar",save:"Guardar",sell:"Venta",cost:"Costo",ship:"Env√≠o",fees:"Tarifas",margin:"Margen",beCPA:"CPA L√≠mite",targetCPA:"CPA Objetivo"},
    expenses:{addTitle:"Agregar Gasto",label:"Etiqueta",amount:"Monto ($)",category:"Categor√≠a",addBtn:"+ Agregar",logTitle:"Registro de Gastos",total:"Total",cats:["herramientas","anuncios","producto","creativo","otro"]},
    folder:{addTitle:"Agregar Nota / Referencia",titlePh:"T√≠tulo ej. Hooks Zonas Azules",contentPh:"Notas, copy, hooks, √°ngulos...",images:"Im√°genes",cat:"Categor√≠a",prod:"Producto",saveBtn:"+ Guardar",noNotes:"Sin notas a√∫n.",addMore:"Agregar m√°s im√°genes"},
    snapshots:{title:"üì∑ Guardar Captura",desc:"Congela tus n√∫meros semana a semana",ph:'Ej. "Fin de Semana 1"',save:"Guardar",none:"Sin capturas a√∫n.",breakdown:"Desglose por Producto"},
    signals:{noData:"‚ö™ Sin datos",scale:"üü¢ Escalar",watch:"üü° Observar",kill:"üî¥ Eliminar"},
  }
};

const FOLDER_CATS=["Swipe File","Angles & Pain Points","Ad Copy & Scripts","Advertorials","VSL Scripts","Shopify Copy","Winner Log","General"];
const CAT_COLORS={"Swipe File":"#8b5cf6","Angles & Pain Points":"#f59e0b","Ad Copy & Scripts":"#3b82f6","Advertorials":"#10b981","VSL Scripts":"#f472b6","Shopify Copy":"#34d399","Winner Log":"#fbbf24","General":"#6b7280"};
const STATUS_COLORS={testing:"#f59e0b",winner:"#10b981",killed:"#ef4444",scaling:"#3b82f6",probando:"#f59e0b",ganador:"#10b981",eliminado:"#ef4444",escalando:"#3b82f6"};
const TODAY=new Date().toISOString().split("T")[0];
const INIT_PRODUCTS=[{id:1,name:"Product A",sellPrice:27,costPrice:4,shipping:4,fees:1},{id:2,name:"Product B",sellPrice:27,costPrice:4,shipping:4,fees:1},{id:3,name:"Product C",sellPrice:27,costPrice:4,shipping:4,fees:1},{id:4,name:"Product D",sellPrice:27,costPrice:4,shipping:4,fees:1}];
const INIT_EXPENSES=[{id:1,label:"Shopify Monthly",amount:39,category:"tools"},{id:2,label:"Domain",amount:15,category:"tools"},{id:3,label:"PageFly/GemPages",amount:29,category:"tools"}];
const BLANK_C={date:TODAY,campaign:"",adset:"",creative:"",product:"Product A",budget:"",spend:"",ctr:"",cpc:"",atc:"",purchases:"",revenue:"",status:"testing"};
const TEMPLATE_NOTES=[
  {id:1,date:new Date().toLocaleDateString(),product:"All",category:"Swipe File",images:[],title:"Swipe File ‚Äî How To Use",content:"HOW TO USE\n===========\nPaste spy research here. Upload ad screenshots with the image tool.\n\nFor each ad save:\n- Platform, run time, hook, format, angle, link, notes\n\nTOOLS: Minea ¬∑ AdSpy ¬∑ BigSpy ¬∑ FB Ad Library ¬∑ TikTok Creative Center"},
  {id:2,date:new Date().toLocaleDateString(),product:"All",category:"Angles & Pain Points",images:[],title:"Angles & Pain Points ‚Äî How To Use",content:"ANGLE FRAMEWORK\n================\n1. Real authority (credibility)\n2. Curiosity gap\n3. Mechanism bridging to product\n\nBLUE ZONE ANGLES:\n- Blue Zones (Okinawa, Sardinia)\n- NASA/Military Research\n- Mediterranean Diet\n- Traditional Chinese Medicine\n- Nobel Prize research\n- Hunza Valley\n- Harvard Longevity Lab\n- Sardinian Shepherd\n- Cold Water/Scandinavian\n- Ancestral Diet"},
  {id:3,date:new Date().toLocaleDateString(),product:"All",category:"Ad Copy & Scripts",images:[],title:"Ad Copy & Scripts ‚Äî How To Use",content:"CREATIVE TESTING\n=================\n- 3 creatives per ad set max\n- Each = different hook/angle\n- Rotate batches of 3, kill losers\n\nHOOK: Pain/Curiosity + Avatar + Specificity\n\nVIDEO (30-60s): Hook > Problem > Solution > Proof > CTA"},
  {id:4,date:new Date().toLocaleDateString(),product:"All",category:"Advertorials",images:[],title:"Advertorials ‚Äî How To Use",content:"STRUCTURE\n==========\n1. Headline (pain/curiosity)\n2. Opening (agitate)\n3. Middle (mechanism)\n4. Transition (curiosity)\n5. CTA (Watch video)\n\n400-600 words. Editorial tone. Not an ad."},
  {id:5,date:new Date().toLocaleDateString(),product:"All",category:"VSL Scripts",images:[],title:"VSL Scripts ‚Äî How To Use",content:"STRUCTURE (5-10 min)\n=====================\n0:00 Hook > 2:00 Problem > 4:00 Enemy > 6:00 Discovery > 8:00 Solution > 9:00 Proof > 10:00 Offer+CTA\n\nTOOLS: ElevenLabs (voice) ¬∑ CapCut (edit) ¬∑ Fiverr (editor)"},
  {id:6,date:new Date().toLocaleDateString(),product:"All",category:"Shopify Copy",images:[],title:"Shopify Copy ‚Äî How To Use",content:"PAGE STRUCTURE\n===============\n1. Headline (transformation)\n2. Lifestyle images\n3. Bullet benefits (3-5)\n4. Reviews\n5. 30 day guarantee\n6. Sticky ATC\n7. FAQ\n\nOFFER: Bundle 2x/3x + cart upsell"},
  {id:7,date:new Date().toLocaleDateString(),product:"All",category:"Winner Log",images:[],title:"Winner Log ‚Äî How To Use",content:"FOR EACH WINNER\n================\nProduct ¬∑ Angle ¬∑ Exact hook ¬∑ Format ¬∑ CPA ¬∑ ROAS ¬∑ Best audience ¬∑ Why it worked ¬∑ Fatigue date\n\nRULE: Scale the angle. Build 5 new creatives on same winning angle."},
  {id:8,date:new Date().toLocaleDateString(),product:"All",category:"General",images:[],title:"General ‚Äî Project Overview",content:"BUDGET: $1,000 | FUNNEL: FB > Advertorial > VSL > Shopify\n\nKILL: $45-50 no purchases ¬∑ CTR<0.8% after $20 ¬∑ CPC>$2.50 no ATC\nSCALE: CPA<$15 + 3 purchases ¬∑ Horizontal first ¬∑ +20-30%/48hrs ¬∑ Never touch winners ¬∑ 3-5 creatives/week"}
];

function load(k,fb){try{const v=localStorage.getItem(k);return v?JSON.parse(v):fb;}catch{return fb;}}
function save(k,v){try{localStorage.setItem(k,JSON.stringify(v));}catch{}}
function imgToB64(f){return new Promise((res,rej)=>{const r=new FileReader();r.onload=()=>res(r.result);r.onerror=rej;r.readAsDataURL(f);});}

function mapFBRow(row){
  const g=(keys)=>{for(const k of keys){for(const rk of Object.keys(row)){if(rk.toLowerCase().includes(k.toLowerCase()))return row[rk];}}return "";};
  const clean=(v)=>String(v||"").replace(/[^0-9.]/g,"");
  return{date:g(["Day","Date","Reporting"])||TODAY,campaign:g(["Campaign name","Campaign"]),adset:g(["Ad set name","Ad Set"]),creative:g(["Ad name","Ad"]),product:"",budget:clean(g(["Daily Budget","Budget"])),spend:clean(g(["Amount spent","Spend","Cost"])),ctr:clean(g(["CTR","Click-through"])),cpc:clean(g(["CPC","Cost per click"])),atc:clean(g(["Adds to cart","Add to Cart","ATC"])),purchases:clean(g(["Purchases","Purchase"])),revenue:clean(g(["Purchase conversion value","Revenue","Value"])),status:"testing"};
}

function ImageUploader({images=[],onChange}){
  const ref=useRef();const[drag,setDrag]=useState(false);
  const handle=async(files)=>{const imgs=[];for(const f of Array.from(files)){if(!f.type.startsWith("image/"))continue;const b=await imgToB64(f);imgs.push({id:Date.now()+Math.random(),src:b,name:f.name});}onChange([...images,...imgs]);};
  return(
    <div>
      <div className={`drop-zone${drag?" drag-over":""}`} onDragOver={e=>{e.preventDefault();setDrag(true);}} onDragLeave={()=>setDrag(false)} onDrop={e=>{e.preventDefault();setDrag(false);handle(e.dataTransfer.files);}} onPaste={e=>{const files=[...(e.clipboardData?.items||[])].filter(i=>i.type.startsWith("image/")).map(i=>i.getAsFile());if(files.length)handle(files);}} onClick={()=>ref.current.click()} tabIndex={0}>
        <div style={{color:"#6b7280",fontSize:12}}>üìé Click, drag & drop, or <strong>Ctrl+V</strong> to paste</div>
        <input ref={ref} type="file" accept="image/*" multiple style={{display:"none"}} onChange={e=>handle(e.target.files)}/>
      </div>
      {images.length>0&&<div style={{display:"flex",flexWrap:"wrap",marginTop:8}}>{images.map(img=><div key={img.id} className="img-thumb"><img src={img.src} alt=""/><div className="del" onClick={()=>onChange(images.filter(x=>x.id!==img.id))}>‚úï</div></div>)}</div>}
    </div>
  );
}

function App(){
  const [lang,setLang]=useState(()=>load("dsc_lang","en"));
  const [tab,setTab]=useState("dashboard");
  const [products,setProducts]=useState(()=>load("dsc_products",INIT_PRODUCTS));
  const [campaigns,setCampaigns]=useState(()=>load("dsc_campaigns",[]));
  const [expenses,setExpenses]=useState(()=>load("dsc_expenses",INIT_EXPENSES));
  const [snapshots,setSnapshots]=useState(()=>load("dsc_snapshots",[]));
  const [notes,setNotes]=useState(()=>load("dsc_notes",TEMPLATE_NOTES));
  const [snapLabel,setSnapLabel]=useState("");
  const [folderFilter,setFolderFilter]=useState("All");
  const [expandedNote,setExpandedNote]=useState(null);
  const [editProduct,setEditProduct]=useState(null);
  const [lightbox,setLightbox]=useState(null);
  const [nc,setNc]=useState(BLANK_C);
  const [newExp,setNewExp]=useState({label:"",amount:"",category:"tools"});
  const [newNote,setNewNote]=useState({title:"",content:"",category:"General",product:"All",images:[]});
  const [importMsg,setImportMsg]=useState("");
  const csvRef=useRef();
  const L=T[lang];

  useEffect(()=>save("dsc_lang",lang),[lang]);
  useEffect(()=>save("dsc_products",products),[products]);
  useEffect(()=>save("dsc_campaigns",campaigns),[campaigns]);
  useEffect(()=>save("dsc_expenses",expenses),[expenses]);
  useEffect(()=>save("dsc_snapshots",snapshots),[snapshots]);
  useEffect(()=>save("dsc_notes",notes),[notes]);

  const totalSpend=campaigns.reduce((s,c)=>s+Number(c.spend||0),0);
  const totalRev=campaigns.reduce((s,c)=>s+Number(c.revenue||0),0);
  const totalPurchases=campaigns.reduce((s,c)=>s+Number(c.purchases||0),0);
  const totalExp=expenses.reduce((s,e)=>s+Number(e.amount||0),0);
  const totalCOGS=campaigns.reduce((s,c)=>{const p=products.find(p=>p.name===c.product);if(!p)return s;return s+Number(c.purchases||0)*(Number(p.costPrice)+Number(p.shipping)+Number(p.fees));},0);
  const netProfit=totalRev-totalSpend-totalCOGS-totalExp;
  const avgCPA=totalPurchases>0?(totalSpend/totalPurchases).toFixed(2):"‚Äî";
  const ROAS=totalSpend>0?(totalRev/totalSpend).toFixed(2):"‚Äî";
  const ctrVals=campaigns.filter(c=>Number(c.ctr)>0);
  const avgCTR=ctrVals.length>0?(ctrVals.reduce((s,c)=>s+Number(c.ctr),0)/ctrVals.length).toFixed(2):"‚Äî";
  const budgetLeft=1000-totalSpend-totalExp;
  const topCampaigns=[...campaigns].filter(c=>Number(c.roas)>0).sort((a,b)=>Number(b.roas)-Number(a.roas)).slice(0,5);

  const prodStats=products.map(p=>{
    const pc=campaigns.filter(c=>c.product===p.name);
    const spend=pc.reduce((s,c)=>s+Number(c.spend||0),0);
    const purchases=pc.reduce((s,c)=>s+Number(c.purchases||0),0);
    const rev=pc.reduce((s,c)=>s+Number(c.revenue||0),0);
    const cogs=purchases*(Number(p.costPrice)+Number(p.shipping)+Number(p.fees));
    const profit=rev-spend-cogs;
    const cpa=purchases>0?(spend/purchases).toFixed(2):"‚Äî";
    const margin=Number(p.sellPrice)-Number(p.costPrice)-Number(p.shipping)-Number(p.fees);
    return{...p,spend,purchases,rev,profit,cpa,margin};
  });

  const getSig=(cpa,margin)=>cpa==="‚Äî"?L.signals.noData:Number(cpa)<=margin*0.65?L.signals.scale:Number(cpa)<=margin?L.signals.watch:L.signals.kill;

  const takeSnap=()=>{
    const snap={id:Date.now(),label:snapLabel.trim()||`Snapshot ${snapshots.length+1}`,date:new Date().toLocaleDateString(),time:new Date().toLocaleTimeString(),totalSpend,totalRev,totalPurchases,totalExp,netProfit,avgCPA,ROAS,avgCTR,budgetLeft,prodStats:prodStats.map(p=>({name:p.name,spend:p.spend,purchases:p.purchases,rev:p.rev,profit:p.profit,cpa:p.cpa}))};
    setSnapshots([snap,...snapshots]);setSnapLabel("");
  };

  const addCampaign=()=>{
    if(!nc.campaign||!nc.spend)return;
    const cpa=Number(nc.purchases)>0?(Number(nc.spend)/Number(nc.purchases)).toFixed(2):"‚Äî";
    const roas=Number(nc.spend)>0?(Number(nc.revenue)/Number(nc.spend)).toFixed(2):"‚Äî";
    setCampaigns([...campaigns,{...nc,id:Date.now(),cpa,roas}]);
    setNc({...BLANK_C,date:new Date().toISOString().split("T")[0],product:nc.product});
  };

  const handleCSV=(file)=>{
    if(!file)return;
    Papa.parse(file,{header:true,skipEmptyLines:true,complete:(results)=>{
      if(!results.data||!results.data.length){setImportMsg("‚ùå "+L.campaigns.importFail);setTimeout(()=>setImportMsg(""),4000);return;}
      const entries=results.data.map(row=>{
        const m=mapFBRow(row);
        const cpa=Number(m.purchases)>0?(Number(m.spend)/Number(m.purchases)).toFixed(2):"‚Äî";
        const roas=Number(m.spend)>0?(Number(m.revenue)/Number(m.spend)).toFixed(2):"‚Äî";
        return{...m,id:Date.now()+Math.random(),cpa,roas};
      });
      setCampaigns(prev=>[...entries,...prev]);
      setImportMsg(`‚úÖ ${entries.length} ${L.campaigns.importSuccess}`);
      setTimeout(()=>setImportMsg(""),5000);
    },error:()=>{setImportMsg("‚ùå "+L.campaigns.importFail);setTimeout(()=>setImportMsg(""),4000);}});
  };

  const addExpense=()=>{if(!newExp.label||!newExp.amount)return;setExpenses([...expenses,{...newExp,id:Date.now(),amount:Number(newExp.amount)}]);setNewExp({label:"",amount:"",category:"tools"});};
  const addNote=()=>{if(!newNote.title)return;setNotes([{...newNote,id:Date.now(),date:new Date().toLocaleDateString()},...notes]);setNewNote({title:"",content:"",category:"General",product:"All",images:[]});};
  const updateNoteImgs=(id,imgs)=>setNotes(notes.map(n=>n.id===id?{...n,images:imgs}:n));
  const filteredNotes=folderFilter==="All"?notes:notes.filter(n=>n.category===folderFilter);

  const liveCPA=nc.purchases&&nc.spend?"$"+(Number(nc.spend)/Number(nc.purchases)).toFixed(2):"‚Äî";
  const liveROAS=nc.spend&&nc.revenue?(Number(nc.revenue)/Number(nc.spend)).toFixed(2)+"x":"‚Äî";
  const liveSig=(()=>{const p=products.find(x=>x.name===nc.product);if(!p||!nc.purchases||!nc.spend)return L.campaigns.enterData;const cpa=Number(nc.spend)/Number(nc.purchases);const margin=Number(p.sellPrice)-Number(p.costPrice)-Number(p.shipping)-Number(p.fees);return cpa<=margin*0.65?L.campaigns.scale:cpa<=margin?L.campaigns.watch:L.campaigns.kill;})();

  const S={
    page:{maxWidth:980,margin:"0 auto",padding:16},
    card:{background:"#1f2937",borderRadius:12,padding:16,border:"1px solid #374151",marginBottom:12},
    btn:{background:"#2563eb",color:"#fff",padding:"6px 14px",borderRadius:6,fontSize:13,fontWeight:600},
    btnSm:{background:"#374151",color:"#aaa",padding:"5px 10px",borderRadius:6,fontSize:12},
    btnGreen:{background:"#065f46",color:"#34d399",padding:"6px 14px",borderRadius:6,fontSize:13,fontWeight:600},
    tabOn:{background:"#2563eb",color:"#fff",padding:"7px 14px",borderRadius:8,fontSize:12,fontWeight:600},
    tabOff:{background:"#1f2937",color:"#9ca3af",padding:"7px 14px",borderRadius:8,fontSize:12},
    th:{color:"#9ca3af",fontSize:11,fontWeight:600,paddingBottom:8,paddingRight:10,textAlign:"left",whiteSpace:"nowrap"},
    td:{fontSize:11,paddingBottom:6,paddingRight:10,paddingTop:6,borderBottom:"1px solid #374151",whiteSpace:"nowrap"},
    lbl:{fontSize:11,color:"#9ca3af",marginBottom:4,display:"block"},
    grid:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(120px,1fr))",gap:8},
    kpi:{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(110px,1fr))",gap:10,marginBottom:12},
  };

  const TABS=["dashboard","campaigns","products","expenses","folder","snapshots"];

  return(
    <div style={S.page}>
      {lightbox&&<div className="lightbox" onClick={()=>setLightbox(null)}><img src={lightbox} alt=""/></div>}

      <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:16,flexWrap:"wrap",gap:8}}>
        <div><h1 style={{fontSize:20,fontWeight:700}}>{L.title}</h1><p style={{color:"#6b7280",fontSize:12,marginTop:4}}>{L.subtitle}</p></div>
        <div style={{display:"flex",gap:6}}>
          {["en","es"].map(l=><button key={l} onClick={()=>setLang(l)} style={{padding:"5px 12px",borderRadius:20,fontSize:12,fontWeight:700,border:"1px solid",background:lang===l?"#2563eb":"#1f2937",color:lang===l?"#fff":"#9ca3af",borderColor:lang===l?"#2563eb":"#374151"}}>{l==="en"?"üá¨üáß EN":"üá™üá∏ ES"}</button>)}
        </div>
      </div>

      <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:20}}>
        {TABS.map(t=><button key={t} style={tab===t?S.tabOn:S.tabOff} onClick={()=>setTab(t)}>{L.tabs[t]}</button>)}
      </div>

      {/* DASHBOARD */}
      {tab==="dashboard"&&<>
        <div style={S.kpi}>
          {[{l:L.dashboard.budgetLeft,v:`$${budgetLeft.toFixed(0)}`,c:budgetLeft<200?"#ef4444":"#10b981"},{l:L.dashboard.totalSpend,v:`$${totalSpend.toFixed(0)}`,c:"#f59e0b"},{l:L.dashboard.totalRevenue,v:`$${totalRev.toFixed(0)}`,c:"#3b82f6"},{l:L.dashboard.netProfit,v:`$${netProfit.toFixed(0)}`,c:netProfit>=0?"#10b981":"#ef4444"},{l:L.dashboard.avgCPA,v:`$${avgCPA}`,c:"#a78bfa"},{l:L.dashboard.roas,v:`${ROAS}x`,c:"#f472b6"},{l:L.dashboard.purchases,v:totalPurchases,c:"#34d399"},{l:L.dashboard.avgCTR,v:`${avgCTR}%`,c:"#fb923c"}].map((k,i)=>(
            <div key={i} style={S.card}><div style={{fontSize:11,color:"#9ca3af",marginBottom:4}}>{k.l}</div><div style={{fontSize:20,fontWeight:700,color:k.c}}>{k.v}</div></div>
          ))}
        </div>

        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>{L.dashboard.budgetAlloc}</div>
          {[{l:L.dashboard.adSpendRes,a:600,u:totalSpend},{l:L.dashboard.toolsSetup,a:150,u:totalExp},{l:L.dashboard.scaleRes,a:250,u:0}].map((b,i)=>(
            <div key={i} style={{marginBottom:10}}>
              <div style={{display:"flex",justifyContent:"space-between",fontSize:12,marginBottom:4}}><span style={{color:"#d1d5db"}}>{b.l}</span><span style={{color:"#9ca3af"}}>${b.u.toFixed(0)} / ${b.a}</span></div>
              <div style={{background:"#374151",borderRadius:4,height:6}}><div style={{height:6,borderRadius:4,width:`${Math.min((b.u/b.a)*100,100)}%`,background:(b.u/b.a)>0.8?"#ef4444":"#3b82f6"}}/></div>
            </div>
          ))}
        </div>

        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>{L.dashboard.topCampaigns}</div>
          {topCampaigns.length===0?<p style={{color:"#6b7280",fontSize:13}}>{L.dashboard.noCampaigns}</p>:(
            <div style={{overflowX:"auto"}}>
              <table style={{width:"100%",borderCollapse:"collapse"}}>
                <thead><tr>{["Campaign","Ad Set","Creative","Spend","Purchases","CPA","ROAS","CTR","Status"].map(h=><th key={h} style={S.th}>{h}</th>)}</tr></thead>
                <tbody>{topCampaigns.map(c=><tr key={c.id}>
                  <td style={S.td}>{c.campaign}</td><td style={S.td}>{c.adset}</td>
                  <td style={{...S.td,maxWidth:100,overflow:"hidden",textOverflow:"ellipsis"}}>{c.creative}</td>
                  <td style={{...S.td,color:"#f59e0b"}}>${c.spend}</td><td style={S.td}>{c.purchases||"‚Äî"}</td>
                  <td style={{...S.td,color:"#a78bfa"}}>{c.cpa==="‚Äî"?"‚Äî":"$"+c.cpa}</td>
                  <td style={{...S.td,color:"#f472b6"}}>{c.roas||"‚Äî"}x</td>
                  <td style={{...S.td,color:Number(c.ctr)>=1.5?"#10b981":Number(c.ctr)>=0.8?"#f59e0b":"#ef4444"}}>{c.ctr||"‚Äî"}%</td>
                  <td style={S.td}><span style={{background:STATUS_COLORS[c.status]||"#374151",color:"#fff",padding:"2px 8px",borderRadius:20,fontSize:10}}>{c.status}</span></td>
                </tr>)}</tbody>
              </table>
            </div>
          )}
        </div>

        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:6}}>{L.dashboard.quickSnap}</div>
          <p style={{fontSize:12,color:"#6b7280",marginBottom:10}}>{L.dashboard.snapDesc}</p>
          <div style={{display:"flex",gap:8}}><input placeholder={L.dashboard.snapPh} value={snapLabel} onChange={e=>setSnapLabel(e.target.value)} style={{flex:1}}/><button style={S.btn} onClick={takeSnap}>{L.dashboard.save}</button></div>
        </div>
      </>}

      {/* CAMPAIGNS */}
      {tab==="campaigns"&&<>
        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:6}}>{L.campaigns.importBtn}</div>
          <p style={{fontSize:12,color:"#6b7280",marginBottom:6}}>{L.campaigns.importDesc}</p>
          <p style={{fontSize:11,color:"#f59e0b",marginBottom:10}}>‚ö†Ô∏è {L.campaigns.importNote}</p>
          <div style={{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"}}>
            <button style={S.btnGreen} onClick={()=>csvRef.current.click()}>üì• {lang==="en"?"Upload FB CSV":"Subir CSV de FB"}</button>
            <input ref={csvRef} type="file" accept=".csv" style={{display:"none"}} onChange={e=>{handleCSV(e.target.files[0]);e.target.value="";}}/>
            {importMsg&&<span style={{fontSize:12,color:"#34d399"}}>{importMsg}</span>}
          </div>
        </div>

        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>{L.campaigns.logTitle}</div>
          <div style={{...S.grid,marginBottom:8}}>
            <div><label style={S.lbl}>{L.campaigns.date}</label><input type="date" value={nc.date} onChange={e=>setNc({...nc,date:e.target.value})} style={{colorScheme:"dark"}}/></div>
            <div><label style={S.lbl}>{L.campaigns.campaign}</label><input placeholder="Joint Pain TOF" value={nc.campaign} onChange={e=>setNc({...nc,campaign:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.adset}</label><input placeholder="Broad 25-65" value={nc.adset} onChange={e=>setNc({...nc,adset:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.creative}</label><input placeholder="Morning stiffness hook" value={nc.creative} onChange={e=>setNc({...nc,creative:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.product}</label><select value={nc.product} onChange={e=>setNc({...nc,product:e.target.value})}>{products.map(p=><option key={p.id}>{p.name}</option>)}</select></div>
            <div><label style={S.lbl}>{L.campaigns.budget}</label><input type="number" placeholder="40" value={nc.budget} onChange={e=>setNc({...nc,budget:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.spend}</label><input type="number" placeholder="38" value={nc.spend} onChange={e=>setNc({...nc,spend:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.ctr}</label><input type="number" placeholder="1.8" step="0.01" value={nc.ctr} onChange={e=>setNc({...nc,ctr:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.cpc}</label><input type="number" placeholder="0.90" step="0.01" value={nc.cpc} onChange={e=>setNc({...nc,cpc:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.atc}</label><input type="number" placeholder="5" value={nc.atc} onChange={e=>setNc({...nc,atc:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.purchases}</label><input type="number" placeholder="2" value={nc.purchases} onChange={e=>setNc({...nc,purchases:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.revenue}</label><input type="number" placeholder="54" value={nc.revenue} onChange={e=>setNc({...nc,revenue:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.campaigns.status}</label><select value={nc.status} onChange={e=>setNc({...nc,status:e.target.value})}>{L.campaigns.statuses.map(x=><option key={x}>{x}</option>)}</select></div>
          </div>
          <div style={{background:"#111827",borderRadius:8,padding:12,marginBottom:12,display:"flex",gap:24,flexWrap:"wrap"}}>
            <div><div style={{fontSize:10,color:"#6b7280"}}>{L.campaigns.cpaAuto}</div><div style={{fontSize:16,fontWeight:700,color:"#a78bfa"}}>{liveCPA}</div></div>
            <div><div style={{fontSize:10,color:"#6b7280"}}>{L.campaigns.roasAuto}</div><div style={{fontSize:16,fontWeight:700,color:"#f472b6"}}>{liveROAS}</div></div>
            <div><div style={{fontSize:10,color:"#6b7280"}}>{L.campaigns.signal}</div><div style={{fontSize:14,fontWeight:700}}>{liveSig}</div></div>
          </div>
          <button style={S.btn} onClick={addCampaign}>{L.campaigns.logBtn}</button>
        </div>

        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>{L.campaigns.logTitle2}</div>
          {campaigns.length===0?<p style={{color:"#6b7280",fontSize:13}}>{L.campaigns.noEntries}</p>:(
            <div style={{overflowX:"auto"}}>
              <table style={{width:"100%",borderCollapse:"collapse"}}>
                <thead><tr>{[L.campaigns.date,"Campaign","Ad Set","Creative",L.campaigns.product,L.campaigns.budget,L.campaigns.spend,L.campaigns.ctr,L.campaigns.cpc,L.campaigns.atc,L.campaigns.purchases,L.campaigns.revenue,"CPA","ROAS",L.campaigns.status,""].map(h=><th key={h} style={S.th}>{h}</th>)}</tr></thead>
                <tbody>{campaigns.map(c=><tr key={c.id}>
                  <td style={S.td}>{c.date}</td><td style={S.td}>{c.campaign}</td><td style={S.td}>{c.adset}</td>
                  <td style={{...S.td,maxWidth:100,overflow:"hidden",textOverflow:"ellipsis"}}>{c.creative}</td>
                  <td style={S.td}>{c.product||<span style={{color:"#ef4444"}}>‚Äî</span>}</td>
                  <td style={S.td}>${c.budget||"‚Äî"}</td>
                  <td style={{...S.td,color:"#f59e0b"}}>${c.spend}</td>
                  <td style={{...S.td,color:Number(c.ctr)>=1.5?"#10b981":Number(c.ctr)>=0.8?"#f59e0b":"#ef4444"}}>{c.ctr||"‚Äî"}%</td>
                  <td style={{...S.td,color:Number(c.cpc)>0&&Number(c.cpc)<=2.5?"#10b981":"#ef4444"}}>${c.cpc||"‚Äî"}</td>
                  <td style={S.td}>{c.atc||"‚Äî"}</td><td style={S.td}>{c.purchases||"‚Äî"}</td>
                  <td style={{...S.td,color:"#3b82f6"}}>${c.revenue||"‚Äî"}</td>
                  <td style={{...S.td,color:"#a78bfa"}}>{c.cpa==="‚Äî"?"‚Äî":"$"+c.cpa}</td>
                  <td style={{...S.td,color:"#f472b6"}}>{c.roas||"‚Äî"}x</td>
                  <td style={S.td}><span style={{background:STATUS_COLORS[c.status]||"#374151",color:"#fff",padding:"2px 8px",borderRadius:20,fontSize:10}}>{c.status}</span></td>
                  <td style={S.td}><button style={{background:"none",color:"#ef4444",fontSize:13}} onClick={()=>setCampaigns(campaigns.filter(x=>x.id!==c.id))}>‚úï</button></td>
                </tr>)}</tbody>
              </table>
            </div>
          )}
        </div>
      </>}

      {/* PRODUCTS */}
      {tab==="products"&&products.map(p=>{
        const margin=Number(p.sellPrice)-Number(p.costPrice)-Number(p.shipping)-Number(p.fees);
        return<div key={p.id} style={S.card}>
          {editProduct===p.id?(
            <div>
              <input style={{marginBottom:8}} value={p.name} onChange={e=>setProducts(products.map(x=>x.id===p.id?{...x,name:e.target.value}:x))}/>
              <div style={S.grid}>{[["sellPrice",L.products.sell+" ($)"],["costPrice",L.products.cost+" ($)"],["shipping",L.products.ship+" ($)"],["fees",L.products.fees+" ($)"]].map(([k,l])=><div key={k}><label style={S.lbl}>{l}</label><input type="number" value={p[k]} onChange={e=>setProducts(products.map(x=>x.id===p.id?{...x,[k]:e.target.value}:x))}/></div>)}</div>
              <button style={{...S.btn,marginTop:10}} onClick={()=>setEditProduct(null)}>{L.products.save}</button>
            </div>
          ):(
            <div style={{display:"flex",justifyContent:"space-between",alignItems:"flex-start"}}>
              <div><div style={{fontWeight:700,marginBottom:8}}>{p.name}</div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(120px,1fr))",gap:"4px 20px",fontSize:12}}>
                  {[[L.products.sell,`$${p.sellPrice}`,"#fff"],[L.products.cost,`$${p.costPrice}`,"#fff"],[L.products.ship,`$${p.shipping}`,"#fff"],[L.products.fees,`$${p.fees}`,"#fff"],[L.products.margin,`$${margin.toFixed(2)}`,"#10b981"],[L.products.beCPA,`$${margin.toFixed(0)}`,"#f59e0b"],[L.products.targetCPA,`$${(margin*0.65).toFixed(0)}`,"#3b82f6"]].map(([l,v,c])=><span key={l} style={{color:"#9ca3af"}}>{l}: <span style={{color:c,fontWeight:600}}>{v}</span></span>)}
                </div>
              </div>
              <button style={S.btnSm} onClick={()=>setEditProduct(p.id)}>{L.products.edit}</button>
            </div>
          )}
        </div>;
      })}

      {/* EXPENSES */}
      {tab==="expenses"&&<>
        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>{L.expenses.addTitle}</div>
          <div style={S.grid}>
            <div><label style={S.lbl}>{L.expenses.label}</label><input placeholder={lang==="en"?"Spy Tool":"Herramienta Esp√≠a"} value={newExp.label} onChange={e=>setNewExp({...newExp,label:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.expenses.amount}</label><input type="number" placeholder="49" value={newExp.amount} onChange={e=>setNewExp({...newExp,amount:e.target.value})}/></div>
            <div><label style={S.lbl}>{L.expenses.category}</label><select value={newExp.category} onChange={e=>setNewExp({...newExp,category:e.target.value})}>{L.expenses.cats.map(c=><option key={c}>{c}</option>)}</select></div>
          </div>
          <button style={{...S.btn,marginTop:12}} onClick={addExpense}>{L.expenses.addBtn}</button>
        </div>
        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>{L.expenses.logTitle}</div>
          {expenses.map(e=><div key={e.id} style={{display:"flex",justifyContent:"space-between",alignItems:"center",padding:"8px 0",borderBottom:"1px solid #374151"}}>
            <div><div style={{fontSize:13,fontWeight:500}}>{e.label}</div><div style={{fontSize:11,color:"#6b7280",textTransform:"capitalize"}}>{e.category}</div></div>
            <div style={{display:"flex",alignItems:"center",gap:12}}><span style={{color:"#ef4444",fontWeight:600}}>${e.amount}</span><button style={{background:"none",color:"#6b7280",fontSize:13}} onClick={()=>setExpenses(expenses.filter(x=>x.id!==e.id))}>‚úï</button></div>
          </div>)}
          <div style={{display:"flex",justifyContent:"space-between",paddingTop:10,fontWeight:700}}><span>{L.expenses.total}</span><span style={{color:"#ef4444"}}>${totalExp}</span></div>
        </div>
      </>}

      {/* FOLDER */}
      {tab==="folder"&&<>
        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:12}}>{L.folder.addTitle}</div>
          <input style={{marginBottom:8}} placeholder={L.folder.titlePh} value={newNote.title} onChange={e=>setNewNote({...newNote,title:e.target.value})}/>
          <textarea rows={4} style={{marginBottom:8,resize:"vertical"}} placeholder={L.folder.contentPh} value={newNote.content} onChange={e=>setNewNote({...newNote,content:e.target.value})}/>
          <div style={{marginBottom:8}}><label style={S.lbl}>{L.folder.images}</label><ImageUploader images={newNote.images} onChange={imgs=>setNewNote({...newNote,images:imgs})}/></div>
          <div style={S.grid}>
            <div><label style={S.lbl}>{L.folder.cat}</label><select value={newNote.category} onChange={e=>setNewNote({...newNote,category:e.target.value})}>{FOLDER_CATS.map(c=><option key={c}>{c}</option>)}</select></div>
            <div><label style={S.lbl}>{L.folder.prod}</label><select value={newNote.product} onChange={e=>setNewNote({...newNote,product:e.target.value})}>{["All",...products.map(p=>p.name)].map(p=><option key={p}>{p}</option>)}</select></div>
          </div>
          <button style={{...S.btn,marginTop:12}} onClick={addNote}>{L.folder.saveBtn}</button>
        </div>
        <div style={{display:"flex",gap:6,flexWrap:"wrap",marginBottom:12}}>
          {["All",...FOLDER_CATS].map(c=><button key={c} style={{padding:"4px 10px",borderRadius:6,fontSize:11,fontWeight:600,background:folderFilter===c?(CAT_COLORS[c]||"#2563eb"):"#1f2937",color:folderFilter===c?"#fff":"#9ca3af"}} onClick={()=>setFolderFilter(c)}>{c}</button>)}
        </div>
        {filteredNotes.length===0?<div style={S.card}><p style={{color:"#6b7280",fontSize:13}}>{L.folder.noNotes}</p></div>:
          filteredNotes.map(n=>(
            <div key={n.id} style={{...S.card,cursor:"pointer"}}>
              <div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}} onClick={()=>setExpandedNote(expandedNote===n.id?null:n.id)}>
                <div style={{display:"flex",alignItems:"center",gap:8,flex:1,minWidth:0}}>
                  <span style={{background:CAT_COLORS[n.category]||"#374151",color:"#fff",padding:"2px 8px",borderRadius:20,fontSize:10,whiteSpace:"nowrap"}}>{n.category}</span>
                  <span style={{fontWeight:600,fontSize:13,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}}>{n.title}</span>
                  {n.product!=="All"&&<span style={{fontSize:11,color:"#6b7280",whiteSpace:"nowrap"}}>{n.product}</span>}
                  {n.images?.length>0&&<span style={{fontSize:10,color:"#3b82f6"}}>üñº {n.images.length}</span>}
                </div>
                <div style={{display:"flex",alignItems:"center",gap:8,marginLeft:8}}>
                  <span style={{fontSize:11,color:"#6b7280"}}>{n.date}</span>
                  <button style={{background:"none",color:"#6b7280",fontSize:13}} onClick={e=>{e.stopPropagation();setNotes(notes.filter(x=>x.id!==n.id));}}>‚úï</button>
                </div>
              </div>
              {expandedNote===n.id&&(
                <div style={{marginTop:12,paddingTop:12,borderTop:"1px solid #374151"}}>
                  {n.content&&<pre style={{color:"#d1d5db",fontSize:12,whiteSpace:"pre-wrap",marginBottom:12}}>{n.content}</pre>}
                  {n.images?.length>0&&<div style={{display:"flex",flexWrap:"wrap",gap:8,marginBottom:12}}>{n.images.map(img=><img key={img.id} src={img.src} alt="" style={{maxWidth:200,borderRadius:8,cursor:"pointer",border:"1px solid #374151"}} onClick={()=>setLightbox(img.src)}/>)}</div>}
                  <div style={{marginTop:8}}><label style={{...S.lbl,marginBottom:6}}>{L.folder.addMore}</label><ImageUploader images={n.images||[]} onChange={imgs=>updateNoteImgs(n.id,imgs)}/></div>
                </div>
              )}
            </div>
          ))
        }
      </>}

      {/* SNAPSHOTS */}
      {tab==="snapshots"&&<>
        <div style={S.card}>
          <div style={{fontSize:13,fontWeight:600,marginBottom:6}}>{L.snapshots.title}</div>
          <p style={{fontSize:12,color:"#6b7280",marginBottom:10}}>{L.snapshots.desc}</p>
          <div style={{display:"flex",gap:8}}><input placeholder={L.snapshots.ph} value={snapLabel} onChange={e=>setSnapLabel(e.target.value)} style={{flex:1}}/><button style={S.btn} onClick={takeSnap}>{L.snapshots.save}</button></div>
        </div>
        {snapshots.length===0?<div style={S.card}><p style={{color:"#6b7280",fontSize:13}}>{L.snapshots.none}</p></div>:
          snapshots.map(snap=>(
            <div key={snap.id} style={S.card}>
              <div style={{display:"flex",justifyContent:"space-between",marginBottom:12}}>
                <div><div style={{fontWeight:700}}>{snap.label}</div><div style={{fontSize:11,color:"#6b7280"}}>{snap.date} at {snap.time}</div></div>
                <button style={{background:"none",color:"#6b7280",fontSize:13}} onClick={()=>setSnapshots(snapshots.filter(x=>x.id!==snap.id))}>‚úï</button>
              </div>
              <div style={S.kpi}>
                {[{l:L.dashboard.budgetLeft,v:`$${snap.budgetLeft.toFixed(0)}`,c:"#10b981"},{l:L.dashboard.totalSpend,v:`$${snap.totalSpend.toFixed(0)}`,c:"#f59e0b"},{l:L.dashboard.totalRevenue,v:`$${snap.totalRev.toFixed(0)}`,c:"#3b82f6"},{l:L.dashboard.netProfit,v:`$${snap.netProfit.toFixed(0)}`,c:snap.netProfit>=0?"#10b981":"#ef4444"},{l:L.dashboard.avgCPA,v:`$${snap.avgCPA}`,c:"#a78bfa"},{l:L.dashboard.roas,v:`${snap.ROAS}x`,c:"#f472b6"},{l:L.dashboard.purchases,v:snap.totalPurchases,c:"#34d399"},{l:L.dashboard.avgCTR,v:`${snap.avgCTR}%`,c:"#fb923c"}].map((k,i)=>(
                  <div key={i} style={{background:"#111827",borderRadius:8,padding:10}}><div style={{fontSize:10,color:"#9ca3af",marginBottom:2}}>{k.l}</div><div style={{fontSize:16,fontWeight:700,color:k.c}}>{k.v}</div></div>
                ))}
              </div>
              <div style={{borderTop:"1px solid #374151",paddingTop:10}}>
                <div style={{fontSize:11,color:"#9ca3af",marginBottom:6,fontWeight:600}}>{L.snapshots.breakdown}</div>
                <div style={{display:"grid",gridTemplateColumns:"repeat(auto-fit,minmax(180px,1fr))",gap:6}}>
                  {snap.prodStats.map(p=><div key={p.name} style={{background:"#111827",borderRadius:6,padding:"6px 10px",fontSize:11}}><div style={{fontWeight:600,marginBottom:2}}>{p.name}</div><div style={{color:"#9ca3af"}}>${p.spend.toFixed(0)} ¬∑ {p.purchases} {L.dashboard.purchases} ¬∑ CPA ${p.cpa}</div></div>)}
                </div>
              </div>
            </div>
          ))
        }
      </>}
    </div>
  );
}

ReactDOM.render(<App/>,document.getElementById("root"));
</script>
</body>
</html>
